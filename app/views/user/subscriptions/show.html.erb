<div class="min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-4xl font-bold text-gray-900 mb-8">サブスクリプション管理</h1>

    <div class="bg-white shadow-lg rounded-lg p-8 mb-8">
      <h2 class="text-2xl font-semibold text-gray-800 mb-6">現在のプラン</h2>
      
      <% if @subscription %>
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <p class="text-gray-600 mb-2">プランタイプ</p>
            <p class="text-xl font-bold text-indigo-600"><%= @subscription.plan_type.capitalize %></p>
          </div>
          <div>
            <p class="text-gray-600 mb-2">ステータス</p>
            <p class="text-xl font-bold <%= @subscription.active? ? 'text-green-600' : 'text-red-600' %>">
              <%= @subscription.status.capitalize %>
            </p>
          </div>
          <% if @subscription.trial_ends_at %>
            <div>
              <p class="text-gray-600 mb-2">トライアル終了日</p>
              <p class="text-xl font-bold text-gray-900"><%= @subscription.trial_ends_at.strftime("%Y年%m月%d日") %></p>
            </div>
          <% end %>
        </div>

        <div class="mt-6 pt-6 border-t border-gray-200">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">プラン変更</h3>
          <div class="flex space-x-4">
            <% unless @subscription.plan_type == 'standard' %>
              <%= link_to "標準プランに変更", checkout_confirmation_path(plan_type: "standard"), 
                  class: "bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700" %>
            <% end %>
            <% unless @subscription.plan_type == 'enterprise' %>
              <%= link_to "エンタープライズプランに変更", checkout_confirmation_path(plan_type: "enterprise"), 
                  class: "bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700" %>
            <% end %>
          </div>
        </div>

        <% if @subscription.active? %>
          <div class="mt-6 pt-6 border-t border-gray-200">
            <%= form_with url: cancel_user_subscription_path, method: :post, 
                data: { confirm: "本当にキャンセルしますか？" } do |f| %>
              <%= f.submit "サブスクリプションをキャンセル", 
                  class: "bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700" %>
            <% end %>
          </div>
        <% end %>
      <% else %>
        <p class="text-gray-600">アクティブなサブスクリプションがありません。</p>
        <%= link_to "プランを選択", plans_path, class: "mt-4 inline-block bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700" %>
      <% end %>
    </div>

    <div class="bg-white shadow-lg rounded-lg p-8">
      <h2 class="text-2xl font-semibold text-gray-800 mb-6">支払い履歴</h2>
      
      <% if @payments.any? %>
        <div class="overflow-x-auto">
          <table class="w-full text-left">
            <thead class="bg-gray-100">
              <tr>
                <th class="py-3 px-4">日付</th>
                <th class="py-3 px-4">金額</th>
                <th class="py-3 px-4">説明</th>
                <th class="py-3 px-4">ステータス</th>
              </tr>
            </thead>
            <tbody>
              <% @payments.each do |payment| %>
                <tr class="border-t border-gray-200">
                  <td class="py-3 px-4"><%= payment.created_at.strftime("%Y/%m/%d") %></td>
                  <td class="py-3 px-4 font-semibold"><%= payment.formatted_amount %></td>
                  <td class="py-3 px-4"><%= payment.description %></td>
                  <td class="py-3 px-4">
                    <span class="px-2 py-1 rounded <%= payment.succeeded? ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %>">
                      <%= payment.status.capitalize %>
                    </span>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="text-gray-600">支払い履歴がありません。</p>
      <% end %>
    </div>
  </div>
</div>

